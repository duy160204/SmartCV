import{d as F,e as D,r as p,g as S,h as x,c as d,a as s,l as M,w as L,k as N,t as g,i as I,q as b,n as m,s as w,v as c,o as u,m as $}from"./index-D0LxdbPe.js";import{paymentApi as B}from"./user.api-DVaxPE5g.js";const T={class:"min-h-screen bg-gray-50"},O={class:"bg-white border-b px-8 py-4 flex justify-between items-center"},h={class:"font-bold text-xl"},j={class:"max-w-4xl mx-auto mt-8 p-6 bg-white rounded shadow"},q={class:"flex border-b mb-6"},z={key:0,class:"space-y-4 max-w-md"},Y={key:1,class:"space-y-4 max-w-md"},G={key:2},H={key:0,class:"text-gray-500"},J={key:1,class:"space-y-6"},K={class:"bg-gradient-to-r from-blue-500 to-indigo-600 text-white p-6 rounded-lg"},Q={class:"text-3xl font-bold"},W={key:0,class:"text-sm mt-2 opacity-80"},X={class:"text-sm mt-1 opacity-80"},Z={class:"grid grid-cols-3 gap-4"},_={key:2,class:"text-gray-500"},le=F({__name:"SettingsPage",setup(ee){var C,U;const f=D(),i=p("profile"),v=p({name:((C=f.user)==null?void 0:C.name)||"",avatarURL:((U=f.user)==null?void 0:U.avatarURL)||""}),r=p({currentPassword:"",newPassword:"",confirmPassword:""}),l=p(null),y=p(!1),P=p(null);S(async()=>{await E()});const E=async()=>{var a,e,o;try{y.value=!0,P.value=null;const n=await x.get("/subscription/me");l.value=((a=n.data)==null?void 0:a.data)||n.data}catch(n){console.error("Failed to load subscription",n),P.value=((o=(e=n.response)==null?void 0:e.data)==null?void 0:o.message)||"Failed to load subscription",l.value={plan:"FREE",status:"ACTIVE"}}finally{y.value=!1}},k=async a=>{var e,o,n;try{const t=await B.create({planCode:a,provider:"VNPAY"});(e=t.data)!=null&&e.paymentUrl?window.location.href=t.data.paymentUrl:alert("Failed to initiate payment: No URL returned")}catch(t){alert("Payment Error: "+(((n=(o=t.response)==null?void 0:o.data)==null?void 0:n.message)||t.message))}},R=async()=>{var a,e;try{await x.put("/users/profile",v.value),await f.checkAuth(),alert("Profile updated!")}catch(o){alert("Error: "+(((e=(a=o.response)==null?void 0:a.data)==null?void 0:e.message)||o.message))}},V=async()=>{var a,e;if(r.value.newPassword!==r.value.confirmPassword){alert("Passwords do not match");return}try{await x.put("/users/password",{currentPassword:r.value.currentPassword,newPassword:r.value.newPassword}),alert("Password changed!"),r.value={currentPassword:"",newPassword:"",confirmPassword:""}}catch(o){alert("Error: "+(((e=(a=o.response)==null?void 0:a.data)==null?void 0:e.message)||o.message))}},A=a=>new Date(a).toLocaleDateString();return(a,e)=>{var n;const o=N("router-link");return u(),d("div",T,[s("nav",O,[s("h1",h,[M(o,{to:"/dashboard"},{default:L(()=>[...e[10]||(e[10]=[$("SmartCV",-1)])]),_:1})]),s("div",null,g((n=I(f).user)==null?void 0:n.name),1)]),s("div",j,[e[24]||(e[24]=s("h2",{class:"text-2xl font-bold mb-6"},"Account Settings",-1)),s("div",q,[s("button",{onClick:e[0]||(e[0]=t=>i.value="profile"),class:m(["px-4 py-2",i.value==="profile"?"border-b-2 border-blue-600 font-bold":""])},"Profile",2),s("button",{onClick:e[1]||(e[1]=t=>i.value="password"),class:m(["px-4 py-2",i.value==="password"?"border-b-2 border-blue-600 font-bold":""])},"Security",2),s("button",{onClick:e[2]||(e[2]=t=>i.value="subscription"),class:m(["px-4 py-2",i.value==="subscription"?"border-b-2 border-blue-600 font-bold":""])},"Subscription",2)]),i.value==="profile"?(u(),d("div",z,[s("div",null,[e[11]||(e[11]=s("label",{class:"block mb-1 font-medium"},"Full Name",-1)),w(s("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>v.value.name=t),class:"w-full border p-2 rounded"},null,512),[[c,v.value.name]])]),s("div",null,[e[12]||(e[12]=s("label",{class:"block mb-1 font-medium"},"Avatar URL",-1)),w(s("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>v.value.avatarURL=t),class:"w-full border p-2 rounded"},null,512),[[c,v.value.avatarURL]])]),s("button",{onClick:R,class:"bg-blue-600 text-white px-4 py-2 rounded"},"Save Changes")])):b("",!0),i.value==="password"?(u(),d("div",Y,[s("div",null,[e[13]||(e[13]=s("label",{class:"block mb-1 font-medium"},"Current Password",-1)),w(s("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>r.value.currentPassword=t),type:"password",class:"w-full border p-2 rounded"},null,512),[[c,r.value.currentPassword]])]),s("div",null,[e[14]||(e[14]=s("label",{class:"block mb-1 font-medium"},"New Password",-1)),w(s("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>r.value.newPassword=t),type:"password",class:"w-full border p-2 rounded"},null,512),[[c,r.value.newPassword]])]),s("div",null,[e[15]||(e[15]=s("label",{class:"block mb-1 font-medium"},"Confirm Password",-1)),w(s("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>r.value.confirmPassword=t),type:"password",class:"w-full border p-2 rounded"},null,512),[[c,r.value.confirmPassword]])]),s("button",{onClick:V,class:"bg-red-600 text-white px-4 py-2 rounded"},"Change Password")])):b("",!0),i.value==="subscription"?(u(),d("div",G,[y.value?(u(),d("div",H,"Loading subscription info...")):l.value?(u(),d("div",J,[s("div",K,[e[16]||(e[16]=s("div",{class:"text-sm opacity-80 mb-1"},"Current Plan",-1)),s("div",Q,g(l.value.plan||"FREE"),1),l.value.endDate?(u(),d("div",W," Expires: "+g(A(l.value.endDate)),1)):b("",!0),s("div",X," Status: "+g(l.value.status||"ACTIVE"),1)]),s("div",Z,[s("div",{class:m(["border rounded-lg p-4",l.value.plan==="FREE"?"border-blue-500 bg-blue-50":""])},[...e[17]||(e[17]=[s("h4",{class:"font-bold text-lg"},"Free",-1),s("p",{class:"text-gray-500 text-sm mb-4"},"Basic features",-1),s("ul",{class:"text-sm space-y-1 text-gray-600"},[s("li",null,"✓ 3 CVs"),s("li",null,"✓ Basic templates"),s("li",null,"✗ PDF Download")],-1)])],2),s("div",{class:m(["border rounded-lg p-4",l.value.plan==="PRO"?"border-blue-500 bg-blue-50":""])},[e[18]||(e[18]=s("h4",{class:"font-bold text-lg"},"Pro",-1)),e[19]||(e[19]=s("p",{class:"text-gray-500 text-sm mb-4"},"$9.99/month",-1)),e[20]||(e[20]=s("ul",{class:"text-sm space-y-1 text-gray-600"},[s("li",null,"✓ 10 CVs"),s("li",null,"✓ All templates"),s("li",null,"✓ PDF Download")],-1)),l.value.plan!=="PRO"&&l.value.plan!=="PREMIUM"?(u(),d("button",{key:0,onClick:e[8]||(e[8]=t=>k("PRO")),class:"mt-4 w-full bg-blue-600 text-white py-2 rounded text-sm hover:bg-blue-700 transition"}," Upgrade ")):b("",!0)],2),s("div",{class:m(["border rounded-lg p-4",l.value.plan==="PREMIUM"?"border-blue-500 bg-blue-50":""])},[e[21]||(e[21]=s("h4",{class:"font-bold text-lg"},"Premium",-1)),e[22]||(e[22]=s("p",{class:"text-gray-500 text-sm mb-4"},"$19.99/month",-1)),e[23]||(e[23]=s("ul",{class:"text-sm space-y-1 text-gray-600"},[s("li",null,"✓ Unlimited CVs"),s("li",null,"✓ All templates"),s("li",null,"✓ AI Assistant")],-1)),l.value.plan!=="PREMIUM"?(u(),d("button",{key:0,onClick:e[9]||(e[9]=t=>k("PREMIUM")),class:"mt-4 w-full bg-indigo-600 text-white py-2 rounded text-sm hover:bg-indigo-700 transition"}," Upgrade ")):b("",!0)],2)])])):(u(),d("div",_,"Unable to load subscription info"))])):b("",!0)])])}}});export{le as default};
