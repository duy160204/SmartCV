import{d as P,e as T,r as c,g as U,h as v,f as j,c as a,a as o,l as N,w as S,k as q,s as w,v as M,y as z,F as B,j as L,m as x,t as f,n as h,u as O,o as l,q as p}from"./index-D0LxdbPe.js";import{cvApi as $}from"./user.api-DVaxPE5g.js";const I={class:"min-h-screen bg-gray-50 p-8"},A={class:"max-w-6xl mx-auto"},D={class:"flex items-center mb-8"},G={class:"bg-white p-6 rounded shadow mb-8"},H={class:"flex justify-between items-center mb-4"},J={class:"flex items-center gap-2 text-sm cursor-pointer"},K={key:0},Q={key:1,class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6"},W=["onClick"],X=["onClick"],Y={class:"aspect-[210/297] bg-gray-200 mb-4 rounded overflow-hidden relative"},Z=["src"],ee={key:1,class:"flex items-center justify-center h-full text-gray-400"},te={key:2,class:"absolute top-2 right-2 bg-yellow-400 text-yellow-900 text-xs font-bold px-2 py-1 rounded shadow-sm z-20"},se={key:0,class:"ml-1"},oe={key:3,class:"absolute inset-0 bg-gray-900 bg-opacity-10 flex items-center justify-center z-10"},ae={class:"font-bold text-center"},le={class:"fixed bottom-0 left-0 right-0 p-4 bg-white border-t flex justify-between items-center px-10 shadow-lg"},re={class:"text-gray-500"},ne={key:0,class:"font-bold text-blue-600"},ie={key:1},de=["disabled"],fe=P({__name:"CreateCVPage",setup(ce){const k=O(),C=T(),b=c([]),d=c([]),_=c(!0),n=c(null),g=c("Untitled CV"),m=c(!1);U(async()=>{try{const[t,e]=await Promise.all([v.get("/templates"),v.get("/cv/favorites")]);b.value=t.data,d.value=e.data}catch(t){console.error(t)}finally{_.value=!1}});const y=t=>d.value.some(e=>e.templateId===t),R=async(t,e)=>{var r,s;e.stopPropagation();try{y(t)?(await v.delete(`/cv/template/${t}/favorite`),d.value=d.value.filter(i=>i.templateId!==t)):(await v.post(`/cv/template/${t}/favorite`),d.value.push({templateId:t}))}catch(i){alert("Failed to update favorite: "+(((s=(r=i.response)==null?void 0:r.data)==null?void 0:s.message)||i.message))}},V=j(()=>{if(m.value){const t=d.value.map(e=>e.templateId);return b.value.filter(e=>t.includes(e.id))}return b.value}),u=t=>{var r;const e=((r=C.user)==null?void 0:r.plan)||"FREE";return!(t.planRequired==="FREE"||e==="PREMIUM"||e==="PRO"&&t.planRequired==="PRO")},F=t=>{u(t)||(n.value=t.id)},E=async()=>{var t,e;if(n.value)try{const r=await $.create({title:g.value,templateId:n.value,content:{profile:{name:"",title:"",email:"",phone:"",summary:"",location:"",website:""},education:[],experience:[],skills:[],projects:[],languages:[],certifications:[],awards:[]}});k.push(`/cv/editor/${r.data.id}`)}catch(r){alert("Failed to create: "+(((e=(t=r.response)==null?void 0:t.data)==null?void 0:e.message)||r.message))}};return(t,e)=>{const r=q("router-link");return l(),a("div",I,[o("div",A,[o("div",D,[N(r,{to:"/",class:"text-gray-500 mr-4"},{default:S(()=>[...e[2]||(e[2]=[x("‚Üê Back",-1)])]),_:1}),e[3]||(e[3]=o("h1",{class:"text-3xl font-bold"},"Create New CV",-1))]),o("div",G,[e[4]||(e[4]=o("label",{class:"block font-bold mb-2"},"CV Title",-1)),w(o("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),class:"w-full border p-2 rounded text-lg",placeholder:"e.g. Software Engineer 2024"},null,512),[[M,g.value]])]),o("div",H,[e[6]||(e[6]=o("h2",{class:"text-xl font-bold"},"Select a Template",-1)),o("label",J,[w(o("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=s=>m.value=s),class:"form-checkbox"},null,512),[[z,m.value]]),e[5]||(e[5]=o("span",null,"Show Favorites Only",-1))])]),_.value?(l(),a("div",K,"Loading templates...")):(l(),a("div",Q,[(l(!0),a(B,null,L(V.value,s=>(l(),a("div",{key:s.id,onClick:i=>F(s),class:h(["border-2 rounded p-4 transition relative",u(s)?"opacity-70 cursor-not-allowed bg-gray-50":"cursor-pointer",n.value===s.id?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300 bg-white"])},[u(s)?p("",!0):(l(),a("button",{key:0,onClick:i=>R(s.id,i),class:h(["absolute top-2 left-2 z-10 text-2xl transition",y(s.id)?"text-red-500":"text-gray-300 hover:text-red-300"])},f(y(s.id)?"‚ù§Ô∏è":"ü§ç"),11,X)),o("div",Y,[s.thumbnailUrl?(l(),a("img",{key:0,src:s.thumbnailUrl,class:"w-full h-full object-cover"},null,8,Z)):(l(),a("div",ee,"Preview")),s.planRequired!=="FREE"?(l(),a("div",te,[x(f(s.planRequired)+" ",1),u(s)?(l(),a("span",se,"üîí")):p("",!0)])):p("",!0),u(s)?(l(),a("div",oe,[...e[7]||(e[7]=[o("div",{class:"bg-white/90 px-3 py-1 rounded text-xs font-bold text-gray-700 shadow"}," Upgrade to Unlock ",-1)])])):p("",!0)]),o("h3",ae,f(s.name),1)],10,W))),128))])),o("div",le,[o("div",re,[e[8]||(e[8]=x(" Selected: ",-1)),n.value?(l(),a("span",ne,"Template #"+f(n.value),1)):(l(),a("span",ie,"None"))]),o("button",{onClick:E,disabled:!n.value,class:h(["px-8 py-3 rounded font-bold text-white",n.value?"bg-blue-600 hover:bg-blue-700":"bg-gray-300 cursor-not-allowed"])}," Create CV ",10,de)])])])}}});export{fe as default};
