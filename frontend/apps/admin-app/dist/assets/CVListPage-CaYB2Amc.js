import{d as L,j as u,k as D,c as n,a as e,y as k,t as d,F as I,r as A,n as h,z as p,o as r}from"./index-DhSIbSTO.js";const $={class:"p-8"},E={key:0,class:"text-center py-12"},S={key:1,class:"bg-red-50 border border-red-200 text-red-700 p-6 rounded text-center"},M={class:"text-sm"},N={key:2,class:"bg-gray-50 p-8 text-center rounded"},F={key:3,class:"bg-white rounded shadow text-sm"},O={class:"w-full text-left border-collapse"},T={class:"p-4"},U={class:"p-4 font-medium"},R={class:"p-4"},j={class:"p-4"},z={class:"p-4"},B={class:"p-4 space-x-2"},J=["onClick"],K=["onClick"],P=["onClick"],q=["onClick"],G={key:4,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},H={class:"bg-white rounded shadow-lg max-w-2xl w-full max-h-[80vh] flex flex-col"},Q={class:"p-6 overflow-y-auto flex-1"},W={key:0,class:"text-center py-8"},X={key:1},Y={class:"grid grid-cols-2 gap-4 mb-6"},Z={class:"font-medium"},ee={class:"bg-gray-100 p-4 rounded text-xs overflow-auto max-h-60"},le=L({__name:"CVListPage",setup(te){const c=u([]),g=u(!0),v=u(null),x=u(!1),i=u(null),b=u(!1),m=async()=>{var o,t;try{g.value=!0,v.value=null;const s=await p.get("/admin/cv");c.value=s.data.data||[]}catch(s){console.error(s),v.value=((t=(o=s.response)==null?void 0:o.data)==null?void 0:t.message)||s.message||"Failed to load CVs"}finally{g.value=!1}};D(()=>{m()});const C=async o=>{var s,l;const t=prompt("Reason for locking:");if(t!==null)try{await p.post(`/admin/cv/${o}/lock`,{reason:t});const a=c.value.find(y=>y.id===o);a&&(a.isLocked=!0)}catch(a){alert("Error: "+(((l=(s=a.response)==null?void 0:s.data)==null?void 0:l.message)||a.message))}},_=async o=>{var s,l;const t=prompt("Reason for unlocking:");if(t!==null)try{await p.post(`/admin/cv/${o}/unlock`,{reason:t});const a=c.value.find(y=>y.id===o);a&&(a.isLocked=!1)}catch(a){alert("Error: "+(((l=(s=a.response)==null?void 0:s.data)==null?void 0:l.message)||a.message))}},w=async o=>{var s,l;if(!confirm("Are you sure you want to delete this CV permanently?"))return;const t=prompt("Reason for deletion (optional):")||"Admin deleted";try{await p.delete(`/admin/cv/${o}`,{data:{reason:t}}),c.value=c.value.filter(a=>a.id!==o)}catch(a){alert("Delete failed: "+(((l=(s=a.response)==null?void 0:s.data)==null?void 0:l.message)||a.message))}},V=async o=>{var t,s;x.value=!0,i.value=null,b.value=!0;try{const l=await p.get(`/admin/cv/${o}`);i.value=l.data.data}catch(l){alert("Failed to load detail: "+(((s=(t=l.response)==null?void 0:t.data)==null?void 0:s.message)||l.message)),x.value=!1}finally{b.value=!1}},f=()=>{x.value=!1,i.value=null};return(o,t)=>(r(),n("div",$,[t[11]||(t[11]=e("h1",{class:"text-2xl font-bold mb-6"},"CV Management",-1)),g.value?(r(),n("div",E,[...t[0]||(t[0]=[e("div",{class:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-4"},null,-1),e("p",{class:"text-gray-500"},"Loading CVs...",-1)])])):v.value?(r(),n("div",S,[t[1]||(t[1]=e("p",{class:"font-bold mb-2"},"Failed to load CVs",-1)),e("p",M,d(v.value),1),e("button",{onClick:m,class:"mt-4 text-blue-600 underline"},"Retry")])):c.value.length===0?(r(),n("div",N,[...t[2]||(t[2]=[e("p",{class:"text-gray-500"},"No CVs found",-1)])])):(r(),n("div",F,[e("table",O,[t[3]||(t[3]=e("thead",null,[e("tr",{class:"border-b bg-gray-50"},[e("th",{class:"p-4"},"ID"),e("th",{class:"p-4"},"Title"),e("th",{class:"p-4"},"User ID"),e("th",{class:"p-4"},"Status"),e("th",{class:"p-4"},"Created At"),e("th",{class:"p-4"},"Actions")])],-1)),e("tbody",null,[(r(!0),n(I,null,A(c.value,s=>(r(),n("tr",{key:s.id,class:"border-b hover:bg-gray-50"},[e("td",T,d(s.id),1),e("td",U,d(s.title||"Untitled"),1),e("td",R,d(s.userId||"-"),1),e("td",j,[e("span",{class:h(["px-2 py-1 rounded text-xs",s.isLocked?"bg-red-100 text-red-800":"bg-green-100 text-green-800"])},d(s.isLocked?"LOCKED":"ACTIVE"),3)]),e("td",z,d(s.createdAt?new Date(s.createdAt).toLocaleDateString():"-"),1),e("td",B,[e("button",{onClick:l=>V(s.id),class:"text-blue-600 hover:underline"},"View",8,J),s.isLocked?(r(),n("button",{key:1,onClick:l=>_(s.id),class:"text-green-600 hover:underline"},"Unlock",8,P)):(r(),n("button",{key:0,onClick:l=>C(s.id),class:"text-yellow-600 hover:underline"},"Lock",8,K)),e("button",{onClick:l=>w(s.id),class:"text-red-500 hover:underline"},"Delete",8,q)])]))),128))])])])),x.value?(r(),n("div",G,[e("div",H,[e("div",{class:"p-4 border-b flex justify-between items-center"},[t[4]||(t[4]=e("h2",{class:"text-xl font-bold"},"CV Detail",-1)),e("button",{onClick:f,class:"text-gray-500 hover:text-gray-700"},"Ã—")]),e("div",Q,[b.value?(r(),n("div",W,[...t[5]||(t[5]=[e("div",{class:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto"},null,-1)])])):i.value?(r(),n("div",X,[e("div",Y,[e("div",null,[t[6]||(t[6]=e("label",{class:"block text-xs text-gray-500"},"Title",-1)),e("div",Z,d(i.value.title||"Untitled"),1)]),e("div",null,[t[7]||(t[7]=e("label",{class:"block text-xs text-gray-500"},"ID / Template",-1)),e("div",null,d(i.value.id)+" / "+d(i.value.templateId),1)]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-xs text-gray-500"},"User ID",-1)),e("div",null,d(i.value.userId),1)]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-xs text-gray-500"},"Status",-1)),e("span",{class:h(["px-2 py-1 rounded text-xs",i.value.isLocked?"bg-red-100 text-red-800":"bg-green-100 text-green-800"])},d(i.value.isLocked?"LOCKED":"ACTIVE"),3)])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-xs text-gray-500 mb-2"},"Metadata (JSON Content)",-1)),e("pre",ee,d(JSON.stringify(JSON.parse(i.value.content||"{}"),null,2)),1)])])):k("",!0)]),e("div",{class:"p-4 border-t text-right"},[e("button",{onClick:f,class:"bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300"},"Close")])])])):k("",!0)]))}});export{le as default};
